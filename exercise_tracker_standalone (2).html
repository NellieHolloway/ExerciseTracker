<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exercise Tracker</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:system-ui,-apple-system,sans-serif;background:linear-gradient(135deg,#eff6ff,#e0e7ff);min-height:100vh}
    .container{max-width:56rem;margin:0 auto;padding:1rem}
    .card{background:#fff;border-radius:1rem;box-shadow:0 10px 15px -3px rgba(0,0,0,0.1);padding:1.5rem;margin-bottom:1.5rem}
    .flex{display:flex}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-between{justify-content:space-between}
    .gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.gap-4{gap:1rem}
    .grid{display:grid}.grid-2{grid-template-columns:repeat(2,1fr)}.grid-3{grid-template-columns:repeat(3,1fr)}.grid-4{grid-template-columns:repeat(4,1fr)}
    .mb-1{margin-bottom:0.25rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.ml-2{margin-left:0.5rem}
    .p-3{padding:0.75rem}.p-4{padding:1rem}
    .w-full{width:100%}.flex-1{flex:1}
    .text-xs{font-size:0.75rem}.text-sm{font-size:0.875rem}.text-lg{font-size:1.125rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem}.text-3xl{font-size:1.875rem}
    .font-semibold{font-weight:600}.font-bold{font-weight:700}
    .text-white{color:#fff}.text-gray-400{color:#9ca3af}.text-gray-500{color:#6b7280}.text-gray-600{color:#4b5563}.text-gray-800{color:#1f2937}
    .text-red-600{color:#dc2626}.text-indigo-600{color:#4f46e5}.text-indigo-100{color:#e0e7ff}
    .text-green-700{color:#15803d}.text-green-800{color:#166534}.text-blue-700{color:#1d4ed8}.text-blue-800{color:#1e40af}
    .text-orange-700{color:#c2410c}.text-orange-800{color:#9a3412}.text-purple-700{color:#7e22ce}.text-purple-800{color:#6b21a8}
    .text-indigo-700{color:#4338ca}.text-indigo-800{color:#3730a3}.text-pink-700{color:#be185d}.text-pink-800{color:#9d174d}
    .text-teal-700{color:#0f766e}.text-teal-800{color:#115e59}.text-blue-900{color:#1e3a8a}
    .bg-white{background:#fff}.bg-gray-50{background:#f9fafb}.bg-gray-200{background:#e5e7eb}.bg-gray-400{background:#9ca3af}
    .bg-red-600{background:#dc2626}.bg-green-600{background:#16a34a}.bg-blue-600{background:#2563eb}.bg-indigo-600{background:#4f46e5}
    .bg-blue-50{background:#eff6ff}
    .grad-green{background:linear-gradient(135deg,#f0fdf4,#dcfce7)}.grad-blue{background:linear-gradient(135deg,#eff6ff,#dbeafe)}
    .grad-orange{background:linear-gradient(135deg,#fff7ed,#ffedd5)}.grad-purple{background:linear-gradient(135deg,#faf5ff,#f3e8ff)}
    .grad-indigo{background:linear-gradient(135deg,#eef2ff,#e0e7ff)}.grad-pink{background:linear-gradient(135deg,#fdf2f8,#fce7f3)}
    .grad-teal{background:linear-gradient(135deg,#f0fdfa,#ccfbf1)}.grad-gray{background:linear-gradient(90deg,#f9fafb,#f3f4f6)}
    .grad-header{background:linear-gradient(90deg,#6366f1,#9333ea)}
    .rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}
    .border-2{border:2px solid}.border-gray-200{border-color:#e5e7eb}.border-gray-300{border-color:#d1d5db}.border-blue-200{border-color:#bfdbfe}
    .shadow-2xl{box-shadow:0 25px 50px -12px rgba(0,0,0,0.25)}
    .cursor-pointer{cursor:pointer}.overflow-auto{overflow-y:auto}.max-h-96{max-height:24rem}
    .fixed{position:fixed}.inset-0{top:0;right:0;bottom:0;left:0}.z-50{z-index:50}
    .overlay{background:rgba(0,0,0,0.5)}
    button{border:none;cursor:pointer;font-family:inherit;transition:filter 0.15s}
    button:hover:not(:disabled){filter:brightness(0.92)}
    button:disabled{opacity:0.5;cursor:not-allowed}
    input,select{font-family:inherit;font-size:1rem;padding:0.5rem 1rem;border:2px solid #d1d5db;border-radius:0.5rem;outline:none}
    input:focus,select:focus{border-color:#6366f1}
    .icon{display:inline-flex;align-items:center;justify-content:center}
    @media(max-width:768px){.grid-3,.grid-4{grid-template-columns:repeat(2,1fr)}.hide-mobile{display:none}}
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect } = React;

const Icon = ({type, size=24}) => {
  const icons = {
    trend: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
    download: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
    plus: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
    calendar: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
    chart: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>,
    sort: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m21 16-4 4-4-4"/><path d="M17 20V4"/><path d="m3 8 4-4 4 4"/><path d="M7 4v16"/></svg>,
    trash: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>,
    history: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>
  };
  return <span className="icon">{icons[type]}</span>;
};

function App() {
  const [exercises, setExercises] = useState([]);
  const [records, setRecords] = useState([]);
  const [newExercise, setNewExercise] = useState('');
  const [showAddExercise, setShowAddExercise] = useState(false);
  const [selectedExercise, setSelectedExercise] = useState(null);
  const [amount, setAmount] = useState('');
  const [recordDate, setRecordDate] = useState(new Date().toISOString().split('T')[0]);
  const [sortBy, setSortBy] = useState('dateAddedNewest');
  const [showHistory, setShowHistory] = useState(false);
  const [loading, setLoading] = useState(true);
  const [deleteConfirm, setDeleteConfirm] = useState(null);
  const [showDailyStats, setShowDailyStats] = useState(false);
  const [showImport, setShowImport] = useState(false);

  useEffect(() => {
    try {
      const e = localStorage.getItem('ex_exercises');
      const r = localStorage.getItem('ex_records');
      if (e) setExercises(JSON.parse(e));
      if (r) setRecords(JSON.parse(r));
    } catch (err) { console.log(err); }
    setLoading(false);
  }, []);

  useEffect(() => { if (!loading) localStorage.setItem('ex_exercises', JSON.stringify(exercises)); }, [exercises, loading]);
  useEffect(() => { if (!loading) localStorage.setItem('ex_records', JSON.stringify(records)); }, [records, loading]);

  const addExercise = () => {
    if (newExercise.trim()) {
      setExercises([...exercises, { id: Date.now().toString(), name: newExercise.trim(), createdAt: new Date().toISOString() }]);
      setNewExercise('');
      setShowAddExercise(false);
    }
  };

  const addRecord = () => {
    if (selectedExercise && amount && recordDate) {
      setRecords([...records, { id: Date.now().toString(), exerciseId: selectedExercise.id, amount: parseFloat(amount), date: recordDate, timestamp: new Date().toISOString() }]);
      setAmount('');
      setRecordDate(new Date().toISOString().split('T')[0]);
    }
  };

  const getStats = (exerciseId) => {
    const recs = records.filter(r => r.exerciseId === exerciseId).sort((a, b) => new Date(b.date) - new Date(a.date));
    if (!recs.length) return { max: 0, average: 0, last4Average: 0, last10Average: 0, count: 0, lastDate: null };
    const amounts = recs.map(r => r.amount);
    const max = Math.max(...amounts);
    const average = amounts.reduce((a, b) => a + b, 0) / amounts.length;
    const last4 = recs.slice(0, 4);
    const last10 = recs.slice(0, 10);
    return {
      max, average,
      last4Average: last4.length ? last4.reduce((a, b) => a + b.amount, 0) / last4.length : 0,
      last10Average: last10.length ? last10.reduce((a, b) => a + b.amount, 0) / last10.length : 0,
      count: recs.length,
      lastDate: recs[0].date
    };
  };

  const getTodayCount = () => {
    const today = new Date().toISOString().split('T')[0];
    return new Set(records.filter(r => r.date === today).map(r => r.exerciseId)).size;
  };

  const getDailyStats = () => {
    const stats = {};
    records.forEach(r => { if (!stats[r.date]) stats[r.date] = new Set(); stats[r.date].add(r.exerciseId); });
    if (records.length) {
      const dates = records.map(r => new Date(r.date));
      const earliest = new Date(Math.min(...dates));
      const today = new Date();
      for (let d = new Date(earliest); d <= today; d.setDate(d.getDate() + 1)) {
        const ds = d.toISOString().split('T')[0];
        if (!stats[ds]) stats[ds] = new Set();
      }
    } else {
      stats[new Date().toISOString().split('T')[0]] = new Set();
    }
    return Object.entries(stats).map(([date, set]) => ({ date, count: set.size })).sort((a, b) => new Date(b.date) - new Date(a.date));
  };

  const getSorted = () => {
    const list = exercises.map(ex => {
      const s = getStats(ex.id);
      return { ...ex, logCount: s.count, lastDate: s.lastDate, percentDiff: s.max > 0 ? (s.last10Average / s.max) * 100 : 0 };
    });
    switch(sortBy) {
      case 'dateAddedNewest': return list.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      case 'dateAddedOldest': return list.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
      case 'alphabetical': return list.sort((a, b) => a.name.localeCompare(b.name));
      case 'mostLogs': return list.sort((a, b) => b.logCount - a.logCount);
      case 'fewestLogs': return list.sort((a, b) => a.logCount - b.logCount);
      case 'lastCompletedRecent': return list.sort((a, b) => { if (!a.lastDate) return 1; if (!b.lastDate) return -1; return new Date(b.lastDate) - new Date(a.lastDate); });
      case 'lastCompletedOldest': return list.sort((a, b) => { if (!a.lastDate) return 1; if (!b.lastDate) return -1; return new Date(a.lastDate) - new Date(b.lastDate); });
      case 'percentDiff': return list.sort((a, b) => b.percentDiff - a.percentDiff);
      default: return list;
    }
  };

  const downloadData = () => {
    let csv = 'Exercise,Date,Amount\n';
    records.forEach(r => { const ex = exercises.find(e => e.id === r.exerciseId); if (ex) csv += `"${ex.name}","${r.date}",${r.amount}\n`; });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv' }));
    a.download = `exercise-tracker-${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
  };

  const importData = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
      try {
        const lines = ev.target.result.split('\n').slice(1).filter(l => l.trim());
        const newEx = [], newRec = [], exMap = {};
        lines.forEach(line => {
          const m = line.match(/("([^"]*)"|[^,]+)/g);
          if (!m || m.length < 3) return;
          const name = m[0].replace(/^"|"$/g, '').trim();
          const date = m[1].replace(/^"|"$/g, '').trim();
          const amt = parseFloat(m[2].replace(/^"|"$/g, '').trim());
          if (!name || !date || isNaN(amt)) return;
          if (!exMap[name]) {
            const id = `imp-${Date.now()}-${Math.random()}`;
            exMap[name] = id;
            newEx.push({ id, name, createdAt: new Date().toISOString() });
          }
          newRec.push({ id: `rec-${Date.now()}-${Math.random()}`, exerciseId: exMap[name], amount: amt, date, timestamp: new Date().toISOString() });
        });
        const merged = [...exercises];
        newEx.forEach(ne => {
          const exists = exercises.find(ex => ex.name === ne.name);
          if (!exists) merged.push(ne);
          else newRec.forEach(r => { if (r.exerciseId === ne.id) r.exerciseId = exists.id; });
        });
        setExercises(merged);
        setRecords([...records, ...newRec]);
        setShowImport(false);
        alert(`Imported ${newRec.length} records!`);
      } catch (err) { alert('Error importing CSV'); }
    };
    reader.readAsText(file);
    e.target.value = '';
  };

  if (loading) return <div className="container" style={{display:'flex',alignItems:'center',justifyContent:'center',minHeight:'100vh'}}><p className="text-xl text-gray-600">Loading...</p></div>;

  const todayCount = getTodayCount();

  return (
    <div className="container">
      {/* Header */}
      <div className="card">
        <div className="flex items-center justify-between gap-4 mb-4" style={{flexWrap:'wrap'}}>
          <div className="flex items-center gap-3">
            <div className="bg-indigo-600 p-3 rounded-xl text-white"><Icon type="trend" size={28}/></div>
            <div>
              <h1 className="text-3xl font-bold text-gray-800">Exercise Tracker</h1>
              <p className="text-gray-600">Track your fitness progress</p>
            </div>
          </div>
          <div className="flex gap-2">
            <button onClick={downloadData} disabled={!records.length} className="flex items-center gap-2 bg-green-600 text-white p-3 rounded-lg font-semibold">
              <Icon type="download" size={18}/> Export
            </button>
            <button onClick={() => setShowImport(true)} className="flex items-center gap-2 bg-blue-600 text-white p-3 rounded-lg font-semibold">
              <Icon type="plus" size={18}/> Import
            </button>
          </div>
        </div>
        
        <div className="grad-header rounded-xl p-4 text-white cursor-pointer" onClick={() => setShowDailyStats(!showDailyStats)}>
          <div className="flex items-center justify-between">
            <div>
              <p className="text-indigo-100 text-sm font-semibold mb-1">TODAY'S PROGRESS</p>
              <p className="text-3xl font-bold">{todayCount} Exercise{todayCount !== 1 ? 's' : ''} Completed</p>
              <p className="text-indigo-100 text-xs mt-1">Click to view daily history</p>
            </div>
            <div style={{background:'rgba(255,255,255,0.2)',padding:'1rem',borderRadius:'0.5rem'}}><Icon type="calendar" size={32}/></div>
          </div>
        </div>
      </div>

      {/* Daily Stats */}
      {showDailyStats && (
        <div className="card">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2"><span className="text-indigo-600"><Icon type="chart" size={24}/></span> Daily History</h2>
            <button onClick={() => setShowDailyStats(false)} className="text-gray-500 text-sm bg-white">Close</button>
          </div>
          <div className="overflow-auto max-h-96">
            {getDailyStats().map(s => {
              const d = new Date(s.date + 'T00:00:00');
              const today = new Date(); today.setHours(0,0,0,0);
              const days = Math.floor((today - d) / 86400000);
              const label = days === 0 ? 'Today' : days === 1 ? 'Yesterday' : `${days} days ago`;
              return (
                <div key={s.date} className={`flex items-center justify-between p-3 rounded-lg mb-2 ${s.count === 0 ? 'grad-gray' : 'grad-indigo'}`}>
                  <div>
                    <p className="font-semibold text-gray-800">{d.toLocaleDateString('en-US', {weekday:'short',year:'numeric',month:'short',day:'numeric'})}</p>
                    <p className="text-sm text-gray-600">{label}</p>
                  </div>
                  <div className={`p-3 rounded-lg font-bold text-white ${s.count === 0 ? 'bg-gray-400' : 'bg-indigo-600'}`}>{s.count} Exercise{s.count !== 1 ? 's' : ''}</div>
                </div>
              );
            })}
          </div>
        </div>
      )}

      {/* Add Exercise */}
      <div className="card">
        <button onClick={() => setShowAddExercise(!showAddExercise)} className="flex items-center gap-2 bg-indigo-600 text-white p-3 rounded-lg w-full justify-center font-semibold">
          <Icon type="plus" size={20}/> Add New Exercise
        </button>
        {showAddExercise && (
          <div className="flex gap-2 mt-4">
            <input type="text" value={newExercise} onChange={e => setNewExercise(e.target.value)} onKeyPress={e => e.key === 'Enter' && addExercise()} placeholder="Exercise name" className="flex-1"/>
            <button onClick={addExercise} className="bg-indigo-600 text-white p-3 rounded-lg">Add</button>
          </div>
        )}
      </div>

      {/* Log Workout */}
      {exercises.length > 0 && (
        <div className="card">
          <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><span className="text-indigo-600"><Icon type="calendar" size={24}/></span> Log Workout</h2>
          <div className="grid grid-3 gap-4">
            <select value={selectedExercise?.id || ''} onChange={e => setSelectedExercise(exercises.find(ex => ex.id === e.target.value))}>
              <option value="">Select exercise</option>
              {exercises.map(ex => <option key={ex.id} value={ex.id}>{ex.name}</option>)}
            </select>
            <input type="number" value={amount} onChange={e => setAmount(e.target.value)} placeholder="Amount"/>
            <input type="date" value={recordDate} onChange={e => setRecordDate(e.target.value)}/>
          </div>
          <button onClick={addRecord} disabled={!selectedExercise || !amount} className="mt-4 w-full bg-indigo-600 text-white p-3 rounded-lg font-semibold">Log Exercise</button>
        </div>
      )}

      {/* Stats */}
      {exercises.length > 0 && (
        <div className="card">
          <div className="flex items-center justify-between gap-3 mb-4" style={{flexWrap:'wrap'}}>
            <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2"><span className="text-indigo-600"><Icon type="chart" size={24}/></span> Statistics</h2>
            <div className="flex items-center gap-2">
              <span className="text-gray-600"><Icon type="sort" size={18}/></span>
              <select value={sortBy} onChange={e => setSortBy(e.target.value)} style={{fontSize:'0.875rem'}}>
                <option value="dateAddedNewest">Date Added (Newest)</option>
                <option value="dateAddedOldest">Date Added (Oldest)</option>
                <option value="alphabetical">Alphabetical</option>
                <option value="mostLogs">Most Logs</option>
                <option value="fewestLogs">Fewest Logs</option>
                <option value="lastCompletedRecent">Last Completed (Recent)</option>
                <option value="lastCompletedOldest">Last Completed (Oldest)</option>
                <option value="percentDiff">L10 AVG/MAX %</option>
              </select>
            </div>
          </div>
          {getSorted().map(ex => {
            const s = getStats(ex.id);
            const pct = s.max > 0 ? (s.last10Average / s.max) * 100 : 0;
            const lastDateInfo = s.lastDate ? (() => {
              const ld = new Date(s.lastDate + 'T00:00:00');
              const today = new Date(); today.setHours(0,0,0,0);
              const days = Math.floor((today - ld) / 86400000);
              return `${ld.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})} (${days}d)`;
            })() : 'N/A';
            return (
              <div key={ex.id} className="border-2 border-gray-200 rounded-xl p-4 mb-4">
                <h3 className="font-bold text-lg text-gray-800 mb-3">{ex.name}</h3>
                <div className="grid grid-3 gap-4 mb-3">
                  <div className="grad-green p-3 rounded-lg"><p className="text-xs text-green-700 font-semibold mb-1">MAX</p><p className="text-2xl font-bold text-green-800">{s.max.toFixed(1)}</p></div>
                  <div className="grad-blue p-3 rounded-lg"><p className="text-xs text-blue-700 font-semibold mb-1">AVERAGE</p><p className="text-2xl font-bold text-blue-800">{s.average.toFixed(1)}</p></div>
                  <div className="grad-orange p-3 rounded-lg"><p className="text-xs text-orange-700 font-semibold mb-1">TOTAL LOGS</p><p className="text-2xl font-bold text-orange-800">{s.count}</p></div>
                </div>
                <div className="grid grid-4 gap-4">
                  <div className="grad-purple p-3 rounded-lg"><p className="text-xs text-purple-700 font-semibold mb-1">LAST 4 AVG</p><p className="text-2xl font-bold text-purple-800">{s.last4Average.toFixed(1)}</p></div>
                  <div className="grad-indigo p-3 rounded-lg"><p className="text-xs text-indigo-700 font-semibold mb-1">LAST 10 AVG</p><p className="text-2xl font-bold text-indigo-800">{s.last10Average.toFixed(1)}</p></div>
                  <div className="grad-pink p-3 rounded-lg"><p className="text-xs text-pink-700 font-semibold mb-1">LAST COMPLETED</p><p className="text-sm font-bold text-pink-800">{lastDateInfo}</p></div>
                  <div className="grad-teal p-3 rounded-lg"><p className="text-xs text-teal-700 font-semibold mb-1">L10 AVG/MAX %</p><p className="text-2xl font-bold text-teal-800">{pct.toFixed(1)}%</p></div>
                </div>
              </div>
            );
          })}
        </div>
      )}

      {exercises.length === 0 && (
        <div className="card" style={{textAlign:'center',padding:'3rem'}}>
          <div className="text-gray-400 mb-4" style={{display:'flex',justifyContent:'center'}}><Icon type="trend" size={64}/></div>
          <h3 className="text-xl font-bold text-gray-800 mb-2">No Exercises Yet</h3>
          <p className="text-gray-600">Add your first exercise to start tracking!</p>
        </div>
      )}

      {/* History */}
      {records.length > 0 && (
        <div className="card">
          <button onClick={() => setShowHistory(!showHistory)} className="flex items-center gap-2 text-lg font-bold text-gray-800 bg-white w-full" style={{textAlign:'left'}}>
            <span className="text-indigo-600"><Icon type="history" size={24}/></span>
            Log History ({records.length} total)
            <span className="text-sm text-gray-500 ml-2">{showHistory ? '(hide)' : '(view)'}</span>
          </button>
          {showHistory && (
            <div className="overflow-auto max-h-96 mt-4">
              {[...records].sort((a, b) => new Date(b.date) - new Date(a.date)).map(r => {
                const ex = exercises.find(e => e.id === r.exerciseId);
                if (!ex) return null;
                return (
                  <div key={r.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg mb-2">
                    <div>
                      <p className="font-semibold text-gray-800">{ex.name}</p>
                      <p className="text-sm text-gray-600">{r.amount} â€¢ {new Date(r.date).toLocaleDateString('en-US',{weekday:'short',year:'numeric',month:'short',day:'numeric'})}</p>
                    </div>
                    <button onClick={() => setDeleteConfirm(r.id)} className="p-2 text-red-600 bg-white rounded-lg"><Icon type="trash" size={18}/></button>
                  </div>
                );
              })}
            </div>
          )}
        </div>
      )}

      {/* Delete Modal */}
      {deleteConfirm && (
        <div className="fixed inset-0 overlay flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl shadow-2xl p-6" style={{maxWidth:'24rem',width:'100%'}}>
            <h3 className="text-xl font-bold text-gray-800 mb-2">Delete Log?</h3>
            <p className="text-gray-600 mb-4">This action cannot be undone.</p>
            <div className="flex gap-3">
              <button onClick={() => setDeleteConfirm(null)} className="flex-1 p-3 bg-gray-200 text-gray-800 rounded-lg font-semibold">Cancel</button>
              <button onClick={() => { setRecords(records.filter(r => r.id !== deleteConfirm)); setDeleteConfirm(null); }} className="flex-1 p-3 bg-red-600 text-white rounded-lg font-semibold">Delete</button>
            </div>
          </div>
        </div>
      )}

      {/* Import Modal */}
      {showImport && (
        <div className="fixed inset-0 overlay flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl shadow-2xl p-6" style={{maxWidth:'32rem',width:'100%'}}>
            <h3 className="text-xl font-bold text-gray-800 mb-2">Import CSV</h3>
            <p className="text-gray-600 mb-4">Upload a CSV with columns: Exercise, Date, Amount</p>
            <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-4">
              <p className="text-sm text-blue-900 font-semibold mb-2">Format:</p>
              <code className="text-xs text-blue-900">Exercise,Date,Amount<br/>"Push-ups","2026-01-10",50</code>
            </div>
            <input type="file" accept=".csv" onChange={importData} className="mb-4 w-full"/>
            <button onClick={() => setShowImport(false)} className="w-full p-3 bg-gray-200 text-gray-800 rounded-lg font-semibold">Cancel</button>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.render(<App/>, document.getElementById('root'));
</script>
</body>
</html>
